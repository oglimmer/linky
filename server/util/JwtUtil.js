
import jwt from 'jsonwebtoken';
import { Promise } from 'bluebird';

import properties from './linkyproperties';

const sign = Promise.promisify(jwt.sign);
const verify = Promise.promisify(jwt.verify);

const KEY = '-----BEGIN CERTIFICATE-----\nMIIDJjCCAg6gAwIBAgIITU7g8Z683Z4wDQYJKoZIhvcNAQEFBQAwNjE0MDIGA1UE\nAxMrZmVkZXJhdGVkLXNpZ25vbi5zeXN0ZW0uZ3NlcnZpY2VhY2NvdW50LmNvbTAe\nFw0xNzA0MjQxMTQzMzRaFw0xNzA0MjcxMjEzMzRaMDYxNDAyBgNVBAMTK2ZlZGVy\nYXRlZC1zaWdub24uc3lzdGVtLmdzZXJ2aWNlYWNjb3VudC5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDzUHwpEZ3euT2f/4VukNrfrRnd6ia2lnf5\nrnnQK2S64MveXhuDgCt3dpqTnfxmG/vh5YYO0XjeSpTQTePN3ODnKsKuFCWv92ZZ\n7ZRK8IObCAB0Lm0TBaXQhevUjSO9Y/cdQULvZaKUlGAFOOTCNIa7LnSqCh4mrT7a\naP9FSH19GfpjLOdsfF1Av3yNTuHg4hA2yLF+0eJ/sLV3r8Tzh3YJN2B0YxmKFEgX\n0fRoEBFityvGp5r4K8M+03p8manc7Y913HDHb1SE9gtLzjxduuhWtT+nDGLrOWB+\nlkJ+m2lLvDe+Jrpp3TJdG3ILQAZw4qh0HYtE50l8W/0IV6kRWs65AgMBAAGjODA2\nMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgeAMBYGA1UdJQEB/wQMMAoGCCsG\nAQUFBwMCMA0GCSqGSIb3DQEBBQUAA4IBAQACq4BSSB3dKqWKoHQ851LaesLGN1Lg\nNriloavtc9utpFFpGx5E/EBjOZUmYynPFnRspjFK8kRj4CsweFX5uCXxwhIht5hV\np3JlhiR+xTxLbLFA6YweJ45qZzQ2tbiEQHH2Z5MyhRSNSuO4XrxM+YwOR0SicqWk\nb//bCLiBjqazrocQebgdvzM+NV1O86OJR1oTQczx5E+/pftBbZ3pGISxqBlbzc5g\nDf4JXo/mfmuF0iqqliepoBJMLXTt3tLPzsERMBlHGZ5wFXOqU4BZLr9sRZPE9adJ\nm5JUB4X83XybssaQuJr3oa2hx3qsfO1RlzkNeCErt7VGOhuD8xHpqfmU\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIDJjCCAg6gAwIBAgIIaOfxaV7G1fEwDQYJKoZIhvcNAQEFBQAwNjE0MDIGA1UE\nAxMrZmVkZXJhdGVkLXNpZ25vbi5zeXN0ZW0uZ3NlcnZpY2VhY2NvdW50LmNvbTAe\nFw0xNzA0MjUxMTQzMzRaFw0xNzA0MjgxMjEzMzRaMDYxNDAyBgNVBAMTK2ZlZGVy\nYXRlZC1zaWdub24uc3lzdGVtLmdzZXJ2aWNlYWNjb3VudC5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCdRve0ZKeOiDhK8Ljgch9HqvxaMzohA/RK\nrj+uqRUX6oKf2eNP0PXbt3R0Z8ZWDFuRrTJJVVDbLC4gUmNyZVSFyUFKC/z4Rx83\n29W2yxgCW18OBIrwBcC/pP0AyF0HIex6gtei4Gc+IXvqco5jEpqBv7WcmgNR0iqu\nPDp6KEImRPl8RYTYYsVE0j0JOS0f0LbN0xjmBPUFH5Z3MGbXENQYUu3pUp2Z4/aR\nsJzao44btyEyZsBOuWb6WOx0mZjbvSj0p341f3RInhos/f+E/5uWpYJbbw4URBr0\n9ICGntvpweNVajFjLYk/dQq5/xk4QHzHCSn6v1yKCcp7xgsfvl7zAgMBAAGjODA2\nMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgeAMBYGA1UdJQEB/wQMMAoGCCsG\nAQUFBwMCMA0GCSqGSIb3DQEBBQUAA4IBAQADgvTre3FfKod26mXVIkM3HyCUtxBG\n4ko4XS8LtCmwbvCLUuUzC5k0TUCAwCdmPmP+zsI/Al0E7O1UQo4UVF7DeWxoi4Fh\nmFZ8h7Fgi6JRKHIjzxAo7JDx4rEzqNO2gNMfZhFFLv1KPaAHjR3p+xhr9mxI82Li\nkXjLRzVA9TOis5gKqSJvkarbaubq+fdzdGC6AX/fkOBkQpqkxiRghI24b2nsoh9c\nQr3t6wJqBkcAQlU42rtiKh8D7ZQ8cRmk0bk9Fp73tc8TFoTlMn9PwkkeMmgdDmEx\n90tMs9yeDckUwgo/U1c8quG9Xy0CWn7l//ReLh6FG3OnqqZ+IDCwufUi\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIDJjCCAg6gAwIBAgIIF+bcH8SiaqkwDQYJKoZIhvcNAQEFBQAwNjE0MDIGA1UE\nAxMrZmVkZXJhdGVkLXNpZ25vbi5zeXN0ZW0uZ3NlcnZpY2VhY2NvdW50LmNvbTAe\nFw0xNzA0MjMxMTQzMzRaFw0xNzA0MjYxMjEzMzRaMDYxNDAyBgNVBAMTK2ZlZGVy\nYXRlZC1zaWdub24uc3lzdGVtLmdzZXJ2aWNlYWNjb3VudC5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDQpiWKbUq+PunFv0cDKYcyuH8qNZgYpeci\nKOvDg2RaXR0DApTPRt1ISvssZsyBFNf7hrDXMR/Vqj6rdp5fIGilYvRjUFqVLuKk\nmIKtfJ3QxbRx10IqcfCZaZlfSSBGdbtswgb+e8gh9f3NXnihhE/NcQZY/5Ed02if\ngKjcnt2TR44j7LUGQpEq4kkgKNakNUkiB9Q4cVjQfF14uECj8hihLLSCt/DAE0Nw\nN1cNx0KBbPRmm9FllB3CNhEmUWMbSmVYciJpIDJ530HZZ8ubhJY1oPWrSg+Yob8+\nxlvx8Fwx6bhXfSCuDoDaY3wDAqHQ8gnixYyY5xrPlAzRfM3aQniFAgMBAAGjODA2\nMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgeAMBYGA1UdJQEB/wQMMAoGCCsG\nAQUFBwMCMA0GCSqGSIb3DQEBBQUAA4IBAQDNdorzMtKYLt1UzMfK9OUToG7BMPPB\nNrchhZBqPUxM02UHSj9p8lth3sGXX3gs0KZ6ul1iLjRyFmlZgwgWs/azdyHdOMEg\nwkb7XAKnb4K9vin7Cb1GKHQCfOlyvS+V1M80Ga+PY9CAsgi0l8nJB5BET7XJNdLB\nNmsV0do1GmaD2cKvva3mn0tiY7cD+ZtGyOAdyOOMXW4g9Xon9TNYtS3lpix54nXN\nOrDdYlKKeS57OiXMBw3kRpE0U4JYg/q4r0rdYeKDyVrhiEEnnqVexpheEUoereDR\nPYtyAzGgBjEqyW/25GoIyrKzIa5ietiNaKHPJmKr4KQlMvypTUSF5RAB\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIDJjCCAg6gAwIBAgIIRmxn1I587BAwDQYJKoZIhvcNAQEFBQAwNjE0MDIGA1UE\nAxMrZmVkZXJhdGVkLXNpZ25vbi5zeXN0ZW0uZ3NlcnZpY2VhY2NvdW50LmNvbTAe\nFw0xNzA0MjYxMTQzMzRaFw0xNzA0MjkxMjEzMzRaMDYxNDAyBgNVBAMTK2ZlZGVy\nYXRlZC1zaWdub24uc3lzdGVtLmdzZXJ2aWNlYWNjb3VudC5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDSYbR9FAC/umid63JojeTGNMsEGKQue4Vw\nV5mbJdbHoCjDzg3b+pViAxuNvYdFQtKnNzalY6eb2Pi47XyTOeqqSGbVwjNc1hcH\nNyvT5cXIZv9OMOXmxst9BDTUtjevWvjl5WrEfSSvhtzPTZOhlYCQ2FFGDxbw6jpW\nKVZDnT2LB0nzW9gAdEHxWyXNIn456ZIMLTAkuV9aFkB0kyGLuKpUZ5f0H29E0Jef\nXxjehZElfMFnHaVv5OuByVtw919o3/xUmqpkAnWONQTMwD0ZqEFE7ncKDto7fOrd\nHpL6D7pFpyy+oSuX2nmC0GlXMBirergNfnUnNeSeqnGysUyV6d71AgMBAAGjODA2\nMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgeAMBYGA1UdJQEB/wQMMAoGCCsG\nAQUFBwMCMA0GCSqGSIb3DQEBBQUAA4IBAQAjDvkEkpmYK5VMEqjgoxhpfQY2iluO\nwY3OaEBYSmahUx6xe1ZXQ4+qkmuLlUwaxCUHCKPzitmybyhjvp2wX9Dz7x5Fzej1\nOqacF1MF221AGQvOUrs2HetG/IjVo7PfZadrlQYOxVk0ZKChuk3PoL3Z3gn6Y24D\nZh6I1di1pKD/QU9Lc3gSi3uXdNGiwRRQYlHngkB/8lxLbvA8YKyGolr4imEQCENd\nCjNHDxVUz3zKBQGHCu45MLRz4FrRG9BqqBLDRgXdKEI59e6PtVq7LMMtDb9p/pyB\nGytOef034LVji3UcUc7YTcIee+CwFkXd47FXJup2sKb2uWV2m6KqcDOK\n-----END CERTIFICATE-----\n';
// const KEYY = '-----BEGIN CERTIFICATE-----\nMIIDBTCCAe2gAwIBAgIQY4RNIR0dX6dBZggnkhCRoDANBgkqhkiG9w0BAQsFADAtMSswKQYDVQQDEyJhY2NvdW50cy5hY2Nlc3Njb250cm9sLndpbmRvd3MubmV0MB4XDTE3MDIxMzAwMDAwMFoXDTE5MDIxNDAwMDAwMFowLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMBEizU1OJms31S/ry7iav/IICYVtQ2MRPhHhYknHImtU03sgVk1Xxub4GD7R15i9UWIGbzYSGKaUtGU9lP55wrfLpDjQjEgaXi4fE6mcZBwa9qc22is23B6R67KMcVyxyDWei+IP3sKmCcMX7Ibsg+ubZUpvKGxXZ27YgqFTPqCT2znD7K81YKfy+SVg3uW6epW114yZzClTQlarptYuE2mujxjZtx7ZUlwc9AhVi8CeiLwGO1wzTmpd/uctpner6oc335rvdJikNmc1cFKCK+2irew1bgUJHuN+LJA0y5iVXKvojiKZ2Ii7QKXn19Ssg1FoJ3x2NWA06wc0CnruLsCAwEAAaMhMB8wHQYDVR0OBBYEFDAr/HCMaGqmcDJa5oualVdWAEBEMA0GCSqGSIb3DQEBCwUAA4IBAQAiUke5mA86R/X4visjceUlv5jVzCn/SIq6Gm9/wCqtSxYvifRXxwNpQTOyvHhrY/IJLRUp2g9/fDELYd65t9Dp+N8SznhfB6/Cl7P7FRo99rIlj/q7JXa8UB/vLJPDlr+NREvAkMwUs1sDhL3kSuNBoxrbLC5Jo4es+juQLXd9HcRraE4U3UZVhUS2xqjFOfaGsCbJEqqkjihssruofaxdKT1CPzPMANfREFJznNzkpJt4H0aMDgVzq69NxZ7t1JiIuc43xRjeiixQMRGMi1mAB75fTyfFJ/rWQ5J/9kh0HMZVtHsqICBF1tHMTMIK5rwoweY0cuCIpN7A/zMOQtoD\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIDBTCCAe2gAwIBAgIQXxLnqm1cOoVGe62j7W7wZzANBgkqhkiG9w0BAQsFADAtMSswKQYDVQQDEyJhY2NvdW50cy5hY2Nlc3Njb250cm9sLndpbmRvd3MubmV0MB4XDTE3MDMyNjAwMDAwMFoXDTE5MDMyNzAwMDAwMFowLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKJGarCm4IF0/Gz5Xx/zyZwD2rdJJZtO2Ukk1Oz+Br1sLVY8I5vj5esB+lotmLEblA9N/w188vmTvykaEzUl49NA4s86x44SW6WtdQbGJ0IjpQJUalUMyy91vIBkK/7K3nBXeVBsRk7tm528leoQ05/aZ+1ycJBIU+1oGYThv8MOjyHAlXJmCaGXwXTisZ+hHjcwlMk/+ZEutHflKLIpPUNEi7j4Xw+zp9UKo5pzWIr/iJ4HjvCkFofW90AMF2xp8dMhpbVcfJGS/Ii3J66LuNLCH/HtSZ42FO+tnRL/nNzzFWUhGT92Q5VFVngfWJ3PAg1zz8I1wowLD2fiB2udGXcCAwEAAaMhMB8wHQYDVR0OBBYEFFXPbFXjmMR3BluF+2MeSXd1NQ3rMA0GCSqGSIb3DQEBCwUAA4IBAQAsd3wGVilJxDtbY1K2oAsWLdNJgmCaYdrtdlAsjGlarSQSzBH0Ybf78fcPX//DYaLXlvaEGKVKp0jPq+RnJ17oP/RJpJTwVXPGRIlZopLIgnKpWlS/PS0uKAdNvLmz1zbGSILdcF+Qf41OozD4QNsS1c9YbDO4vpC9v8x3PVjfJvJwPonzNoOsLXA+8IONSXwCApsnmrwepKu8sifsFYSwgrwxRPGTEAjkdzRJ0yMqiY/VoJ7lqJ/FBJqqAjGPGq/yI9rVoG+mbO1amrIDWHHTKgfbKk0bXGtVUbsayyHR5jSgadmkLBh5AaN/HcgDK/jINrnpiQ+/2ewH/8qLaQ3B\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIDKDCCAhCgAwIBAgIQBHJvVNxP1oZO4HYKh+rypDANBgkqhkiG9w0BAQsFADAjMSEwHwYDVQQDExhsb2dpbi5taWNyb3NvZnRvbmxpbmUudXMwHhcNMTYxMTE2MDgwMDAwWhcNMTgxMTE2MDgwMDAwWjAjMSEwHwYDVQQDExhsb2dpbi5taWNyb3NvZnRvbmxpbmUudXMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQChn5BCs24Hh6L0BNitPrV5s+2/DBhaeytOmnghJKnqeJlhv3ZczShRM2Cp38LW8Y3wn7L3AJtolaSkF/joKN1l6GupzM+HOEdq7xZxFehxIHW7+25mG/WigBnhsBzLv1SR4uIbrQeS5M0kkLwJ9pOnVH3uzMGG6TRXPnK3ivlKl97AiUEKdlRjCQNLXvYf1ZqlC77c/ZCOHSX4kvIKR2uG+LNlSTRq2rn8AgMpFT4DSlEZz4RmFQvQupQzPpzozaz/gadBpJy/jgDmJlQMPXkHp7wClvbIBGiGRaY6eZFxNV96zwSR/GPNkTObdw2S8/SiAgvIhIcqWTPLY6aVTqJfAgMBAAGjWDBWMFQGA1UdAQRNMEuAEDUj0BrjP0RTbmoRPTRMY3WhJTAjMSEwHwYDVQQDExhsb2dpbi5taWNyb3NvZnRvbmxpbmUudXOCEARyb1TcT9aGTuB2Cofq8qQwDQYJKoZIhvcNAQELBQADggEBAGnLhDHVz2gLDiu9L34V3ro/6xZDiSWhGyHcGqky7UlzQH3pT5so8iF5P0WzYqVtogPsyC2LPJYSTt2vmQugD4xlu/wbvMFLcV0hmNoTKCF1QTVtEQiAiy0Aq+eoF7Al5fV1S3Sune0uQHimuUFHCmUuF190MLcHcdWnPAmzIc8fv7quRUUsExXmxSX2ktUYQXzqFyIOSnDCuWFm6tpfK5JXS8fW5bpqTlrysXXz/OW/8NFGq/alfjrya4ojrOYLpunGriEtNPwK7hxj1AlCYEWaRHRXaUIW1ByoSff/6Y6+ZhXPUe0cDlNRt/qIz5aflwO7+W8baTS4O8m/icu7ItE=\n-----END CERTIFICATE-----\n';

class JwtUtil {

  static decode(claim) {
    return jwt.decode(claim);
  }

  static verifyOpenId(authToken) {
    console.log(authToken);
    console.log(jwt.decode(authToken));
    return verify(authToken, KEY, {
      algorithms: ['RS256'],
    });
  }

  static verify(authToken) {
    return verify(authToken, properties.server.jwt.secret);
  }

  static sign(claim, expiresInParam) {
    const expiresIn = !expiresInParam ? properties.server.jwt.expiresIn : expiresInParam;
    return sign(claim, properties.server.jwt.secret, {
      expiresIn,
    });
  }

}

export default JwtUtil;
