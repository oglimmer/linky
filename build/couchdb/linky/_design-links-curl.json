{
  "_id": "_design/links",
  "language": "javascript",
  "views": {
    "byUserid": {
      "map": "function(doc) {\n  if(doc.type === 'link') {\n    emit(doc.userid, doc);\n  }\n}"
    },
    "allTags": {
      "map": "function(doc) {\n  if(doc.type === 'link') {\n    for(var i = 0 ; i < doc.tags.length ; i++) {\n      emit([doc.userid, doc.tags[i]], 1);\n    }\n  }\n}",
      "reduce": "function (key, values, rereduce) {\n    return sum(values);\n}"
    },
    "byUseridAndTag": {
      "map": "function(doc) {\n  if(doc.type === 'link') {\n    for(var i = 0; i < doc.tags.length; i++) {\n      emit([doc.userid, doc.tags[i]], doc);\n    }\n  }\n}"
    },
    "byUseridAndMiniUrl": {
      "map": "function(doc) {\n  if(doc.type === 'link') {\n    var linkUrl = doc.linkUrl;\n    if (linkUrl.indexOf('http://') === 0) {\n      linkUrl = linkUrl.substring(7);\n    }\n    if (linkUrl.indexOf('https://') === 0) {\n      linkUrl = linkUrl.substring(8);\n    }\n    if (linkUrl[linkUrl.length - 1] === '/') {\n      linkUrl = linkUrl.substring(0, linkUrl.length - 1);\n    }\n    emit([doc.userid, linkUrl], doc);\n  }\n}"
    }
  }
}